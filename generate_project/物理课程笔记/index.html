<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="dynamic-title"></title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/markdown/markdown.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="script.js" defer></script>
    <script>
        // 在浏览器环境中提供fs模块的polyfill
        window.fs = {
            existsSync: () => false,
            mkdirSync: () => {},
            writeFileSync: () => {}
        };
    </script>
</head>
<body>
    <header>
        <h1 id="main-title"></h1>
        <div class="toolbar">
        <button id="save-publish-btn">保存并发布</button>
        
        <!-- 分类选择对话框 -->
        <div id="category-dialog" class="dialog">
            <div class="dialog-content">
                <h3>选择分类</h3>
                <div class="category-select">
                    <label>主分类：
                        <select id="main-category">
                            <option value="未分类">未分类</option>
                        </select>
                    </label>
                    <label>子分类：
                        <select id="sub-category">
                            <option value="未分类">未分类</option>
                        </select>
                    </label>
                </div>
                <div class="dialog-buttons">
                    <button id="confirm-save">确认保存</button>
                    <button id="cancel-save">取消</button>
                </div>
            </div>
        </div>
        </div>
    </header>
    <div class="container">
<nav id="sidebar"></nav>
<script>
    // 动态加载导航栏
    fetch('site_data.json')
        .then(response => response.json())
        .then(data => {
            // 设置标题
            document.getElementById('dynamic-title').textContent = data.title;
            document.getElementById('main-title').textContent = data.title;

            // 生成导航栏
            const sidebar = document.getElementById('sidebar');
            data.categories.forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'category-title';
                categoryTitle.textContent = category.name;
                categoryDiv.appendChild(categoryTitle);

                category.subcategories.forEach(subcategory => {
                    const subcategoryDiv = document.createElement('div');
                    subcategoryDiv.className = 'subcategory';
                    
                    const link = document.createElement('a');
                    link.href = `notes/${category.name}/${subcategory.name}/contents.html`;
                    link.textContent = subcategory.name;
                    subcategoryDiv.appendChild(link);
                    
                    categoryDiv.appendChild(subcategoryDiv);
                });

                sidebar.appendChild(categoryDiv);
            });
        })
        .catch(error => console.error('Error loading site data:', error));
</script>
        <div class="main-content">
            <div id="markdown-input" class="markdown-input" contenteditable="true" spellcheck="false"></div>
            <div id="html-output"></div>
        </div>
    </div>
</body>
</html>
